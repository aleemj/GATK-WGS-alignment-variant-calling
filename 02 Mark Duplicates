#File: scripts/02_mark_duplicates.sh

#!/bin/bash
#PBS -N markdup
#PBS -l select=1:ncpus=8:mem=30gb
#PBS -j oe

module load gatk samtools

SAMPLE=$1
IN=bam/${SAMPLE}.sorted.bam
OUT=bam/${SAMPLE}.markdup.bam
METRICS=bam/${SAMPLE}.dup_metrics.txt

gatk MarkDuplicatesSpark \
  -I $IN -O $OUT \
  --metrics-file $METRICS

samtools index $OUT


#Submit:
for s in $(ls samples); do qsub scripts/02_mark_duplicates.sh $s; done
